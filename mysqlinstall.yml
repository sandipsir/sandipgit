--- 
- 
  become: true
  become_method: sudo
  hosts: debian
  tasks: 
    - 
      apt:
        update_cache: yes 
        name: 
          - mysql-server
          - python3-pip
        state: latest
      name: "Install mysql and pip"
      
    - 
      name: "Install python lib"
      pip: 
        name: 
          - pymysql
        state: present
      
    - 
      command: "mysql -u root --execute=\"UPDATE mysql.user SET plugin='mysql_native_password' WHERE User='root';\""
      ignore_errors: yes
      name: "create mysql root user plugin"
    - 
      command: "mysql -u root --execute=\"FLUSH PRIVILEGES;\""
      ignore_errors: yes
      name: "grant priv"
    - 
      name: "service mysql restart"
      shell: "service mysql restart"
    - 
      command: "mysql -u root --execute=\"ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'password';\""
      ignore_errors: yes
      name: "changing root user password"
    - 
      mysql_db: "name=test state=present login_user=root login_password=password"
      ignore_errors: yes
      name: "create mysql database"